OUTPUT := x64

#INCSPATH := -Ilibjson
INCSPATH := 
LIBSPATH := 
#LIBS := -lgmpxx -lgmp -ljson
LIBS := -lgmpxx -lgmp -lcurl

OBJS := sha256.o ElGamal.o Random.o encrypt.o

all: build

build: $(OUTPUT) $(OBJS)
	$(CXX) -DNDEBUG -g $(OUTPUT)/*.o main.cpp -o $(OUTPUT)/agora-airgap $(INCSPATH) $(LIBSPATH) $(LIBS)

.PHONY: build clean all run gui

clean:
	rm -Rf $(OUTPUT)
	
%.o:  %.cpp
	$(CXX) -DNDEBUG -g -c  $^ $(INCSPATH)
	mv $@ $(OUTPUT)
	
$(OUTPUT):
	mkdir -p $@

$(OUTPUT)/screen.png:
	cp screen.png $(OUTPUT)
	
run:
	cd example && python -m SimpleHTTPServer & echo "$$!" > pid
	sleep 1
	$(OUTPUT)/agora-airgap download-audit example/ballot.json || true
	kill `cat pid`
	rm pid

gui: $(OUTPUT) $(OUTPUT)/screen.png $(OBJS)
# `wx-config --libs` `wx-config --cxxflags`
	$(CXX) -DNDEBUG -g $(OUTPUT)/*.o interface.cpp   `wx-config --cxxflags --libs` -o $(OUTPUT)/interface $(INCSPATH) $(LIBSPATH) $(LIBS)
	